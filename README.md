# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Larek Frontend

Документация по архитектуре веб‑проекта «Larek Frontend» оформлена согласно паттерну MVP (Model‑View‑Presenter) и событийно‑ориентированному подходу. В данном проекте реализовано четкое разделение ответственности между тремя слоями:

- **Модель** – отвечает за хранение и управление данными приложения (каталог товаров, корзина, заказ, ошибки валидации).
- **Представление (View)** – отвечает за отображение информации, рендеринг элементов интерфейса и обработку событий, происходящих в DOM.
- **Презентер** – связывает Модель и Представление, обрабатывает события от пользователя, инициирует изменение данных в модели и обновление представления.

---

----------

## Слой Модель

### Класс Api

**Назначение:**  
Класс `Api` служит для взаимодействия с REST‑API. Он инкапсулирует логику отправки HTTP‑запросов, обработки ответов и ошибок.

**Конструктор:**  
Принимает два параметра:

-   `baseUrl` (string) — базовый URL для запросов.
-   `options` (object) — дополнительные параметры запроса (например, заголовки).

**Поля:**

-   `baseUrl` – базовый URL для всех запросов.
-   `options` – настройки HTTP‑запросов (например, заголовки).

**Методы:**

-   `handleResponse(response)` – обрабатывает ответ сервера: при успехе возвращает JSON‑представление, при ошибке генерирует исключение.
-   `get(uri)` – выполняет GET‑запрос, объединяя `uri` с `baseUrl`, и возвращает результат через обработчик ответа.
-   `post(uri, data, method = 'POST')` – выполняет POST‑или PUT‑запрос с сериализованными данными и обрабатывает ответ.

----------

### Класс AppState

**Назначение:**  
Класс `AppState` управляет состоянием приложения. Он содержит данные о каталоге товаров, корзине и заказе.  
**Важно:** список товаров в корзине хранится только в одном месте – в свойстве `basketItems`.

**Конструктор:**  
При инициализации создаются следующие поля:

-   `massProduct` – массив всех доступных товаров (каталог).
-   `basketItems` – массив товаров, добавленных в корзину.
-   `order` – объект, содержащий данные заказа (например, общая сумма).
-   `formErrors` – объект, где ключами являются названия полей формы, а значениями – сообщения об ошибках.

**Методы:**

-   `setContactField(field: string, value: any)` – устанавливает значение контактного поля и запускает валидацию контактов.
-   `setOrderField(field: string, value: any)` – обновляет конкретное поле заказа и инициирует его валидацию.
-   `validateContacts()` – проверяет корректность заполнения контактных полей (например, email, phone) и обновляет `formErrors`.
-   `validateOrder()` – проверяет поля заказа (например, способ оплаты, адрес) и обновляет ошибки.
-   **Сеттер** `addProductBasket` – добавляет товар в `basketItems` (если его там ещё нет) и генерирует событие об изменении данных.
-   `deleteAllProducts()` – очищает корзину, сбрасывая список товаров в `basketItems`.
-   **Сеттер** `setMassProducts(products: IProduct[])` – устанавливает список доступных товаров каталога.
-   **Геттер** `getMassProducts()` – возвращает массив товаров каталога.
-   **Геттер** `totalPrice` – рассчитывает и возвращает общую стоимость товаров.
-   **Геттер** `allIdProducts` – возвращает массив идентификаторов товаров в корзине.
-   `createOrderToPost()` – формирует полноценный объект заказа (`IOrder`), объединяя данные из `order` (например, итоговую сумму, способ оплаты, адрес, контакты) и список товаров из `basketItems`.
-   `clearAllData()` – очищает корзину и сбрасывает данные заказа.

----------

## Слой Представления (View)

### Базовый компонент для карточек: BaseCard

**Назначение:**  
Класс `BaseCard` является базовым для всех карточек товаров. Он хранит ссылки на элементы разметки карточки и содержит базовую логику для их обновления.

**Наследование:**  
Другие классы карточек (например, `CatalogProduct`, `Card`, `CardBasket`) наследуются от `BaseCard`.

**Конструктор:**  
Принимает HTML‑элемент карточки. Инициализируются:

-   `_card` – корневой контейнер карточки.
-   `_category` – элемент для отображения категории товара.
-   `_image` – элемент для показа изображения.
-   `_title` – элемент для заголовка товара.
-   `_price` – элемент для цены (тип: `number | null`, если товар бесценный).
-   `_text` – элемент для описания товара.
-   `_button` – кнопка для действия (например, добавление в корзину).

**Методы:**  
Публичные методы для обновления содержимого карточки (имена методов совпадают с именами полей данных):

-   `setImg(value: string)` – устанавливает URL изображения.
-   `setPrice(value: number | null)` – устанавливает цену товара.
-   `setCategory(value: string)` – устанавливает текстовое значение категории.
-   `setCategoryClass(value: string)` – устанавливает CSS‑класс для категории.
-   `setTitle(value: string)` – устанавливает заголовок товара.
-   `setText(value: string)` – устанавливает описание товара.

----------

### Класс CatalogProduct

**Назначение:**  
Представляет карточку товара в каталоге. При клике генерируется событие для перехода на страницу с подробной информацией о товаре.

**Наследование:**  
Класс `CatalogProduct` наследуется от `BaseCard`.

**Конструктор:**  
Принимает:

-   HTML‑элемент карточки.
-   Объект‑обработчик клика (`click-handler`), вызываемый при нажатии.

**Зона ответственности:**  
Генерация события при клике, которое передаётся презентеру для дальнейшей обработки.

----------

### Класс Card

**Назначение:**  
Представляет отдельную карточку товара с дополнительной логикой (например, управление состоянием кнопки добавления в корзину).

**Конструктор:**  
Принимает:

-   HTML‑элемент карточки.
-   Булево значение, определяющее, должна ли кнопка быть заблокирована.
-   Объект‑обработчик клика для кнопки.

**Методы:**  
Обрабатывает событие клика по кнопке и передаёт его в систему событий для инициирования добавления товара в корзину.

----------

### Класс CardBasket

**Назначение:**  
Отвечает за отображение товара в корзине. Помимо информации, унаследованной от `BaseCard`, включает отображение порядкового номера товара.

**Конструктор:**  
Принимает:

-   HTML‑элемент карточки.
-   Объект‑обработчик клика для удаления товара из корзины.

**Поля:**

-   `_basketIndex` – элемент для отображения порядкового номера товара.

**Методы:**

-   `setBasketIndex(value: number)` – устанавливает порядковый номер товара в корзине.

----------

### Класс Basket

**Назначение:**  
Отвечает за отрисовку и управление корзиной покупок.

**Конструктор:**  
Принимает:

-   HTML‑контейнер корзины.
-   Объект для работы с событиями (events‑emitter).

**Примечание:**  
Поле, отвечающее за кнопку открытия корзины (например, в хэдэре), не включается в данный класс, так как относится к отдельному представлению.

**Поля:**

-   `basket` – корневой HTML‑элемент корзины.
-   `basketList` – контейнер для карточек товаров.
-   `basketButton` – кнопка оформления заказа.
-   `_basketPrice` – элемент для отображения общей стоимости товаров.

**Методы:**

-   `setBasketPrice(value: number)` – устанавливает и форматирует общую стоимость товаров в корзине.
-   `setItems(items: HTMLElement[])` – обновляет содержимое корзины и активирует кнопку оформления заказа.
-   `clearBasketList()` – очищает содержимое корзины.

----------

### Класс Form

**Назначение:**  
Базовый класс для работы с HTML‑формами. Обеспечивает обработку ввода, валидацию, отправку данных и отображение ошибок.

**Конструктор:**  
Принимает:

-   HTML‑элемент формы (`container`).
-   Объект для работы с событиями (events).

**Поля:**

-   `container` – HTML‑форма.
-   `_submit` – кнопка отправки формы.
-   `_errors` – элемент для отображения ошибок.

**Методы:**

-   `onInputChange(field: string, value: any)` – обрабатывает изменения в полях ввода и генерирует событие.
-   `setValid(isValid: boolean)` – устанавливает состояние кнопки отправки в зависимости от валидности формы.
-   `setErrors(errors: { [key: string]: string })` – отображает сообщения об ошибках.
-   `render(state: any)` – обновляет форму согласно переданным данным (значения полей, состояние кнопки, ошибки).

----------

### Класс OrderForm

**Назначение:**  
Отвечает за отображение формы оформления заказа, включая выбор способа оплаты и ввод адреса доставки.

**Конструктор:**  
Принимает:

-   HTML‑элемент формы.
-   Объект для работы с событиями.

**Поля:**

-   `_cardPaymentButton` – кнопка для выбора оплаты картой.
-   `_cashPaymentButton` – кнопка для выбора оплаты наличными.

**Методы:**

-   `disablePaymentButtons()` – снимает активное состояние с кнопок оплаты.
-   `setPayment(value: 'card' | 'cash')` – активирует соответствующую кнопку в зависимости от выбранного способа оплаты.
-   `setAddress(value: string)` – устанавливает значение поля ввода адреса доставки.

----------

### Класс ContactsForm

**Назначение:**  
Отвечает за форму ввода контактных данных (телефон, email).

**Конструктор:**  
Принимает:

-   HTML‑элемент формы.
-   Объект для работы с событиями.

**Методы:**

-   `setPhone(value: string)` – устанавливает значение поля телефона.
-   `setEmail(value: string)` – устанавливает значение поля email.

----------

### Класс Success

**Назначение:**  
Отвечает за отображение модального окна с сообщением об успешном оформлении заказа.

**Конструктор:**  
Принимает:

-   HTML‑контейнер модального окна.
-   Объект‑обработчик клика для закрытия окна.

**Поля:**

-   `container` – HTML‑контейнер модального окна.
-   `orderSuccessDescription` – элемент для вывода сообщения с суммой заказа.
-   `orderSuccessClose` – кнопка для закрытия модального окна.

**Методы:**

-   `setPrice(value: number)` – принимает число (стоимость заказа), форматирует его и устанавливает текст в `orderSuccessDescription`.

----------

## Слой Презентера

**Назначение:**  
Презентер связывает Модель и Представление, обрабатывая события и инициируя обновления.

**Основные задачи:**

-   **Перехват событий от View:**  
    Например, при клике по кнопке «Добавить в корзину» класс `Card` генерирует событие **click:add:basket**.
    
-   **Описание используемых событий:**
    
    -   **click:add:basket** – инициируется при нажатии на кнопку добавления товара в корзину.
    -   **counter:basket** – генерируется моделью при изменении количества товаров в корзине.  
-   **Вызов методов модели:**  
    Получив событие, презентер вызывает метод `addProductBasket` класса `AppState` для обновления корзины.
    
-   **Обработка событий от модели:**  
    После изменения данных модель генерирует соответствующее событие, которое перехватывается презентером.
    
-   **Обновление представления:**  
    Презентер запрашивает обновлённые данные (например, через свойства `totalPrice` или `allIdProducts`) и передаёт их в класс `Basket` для перерисовки интерфейса.
    

### Пример сценария взаимодействия

**Сценарий:** Пользователь нажимает кнопку «Добавить в корзину» на карточке товара.

1.  **Вью:**
    
    -   Класс `Card` обрабатывает клик по кнопке добавления товара.
    -   При нажатии генерируется событие **click:add:basket**.
2.  **Презентер:**
    
    -   Перехватывает событие **click:add:basket**.
    -   Вызывает метод `addProductBasket` класса `AppState`, передавая выбранный товар.
3.  **Модель:**
    
    -   Метод `addProductBasket` проверяет, добавлен ли товар в корзину.
    -   Если товара ещё нет, он добавляется в массив `basketItems`.
    -   Генерируется событие **counter:basket**.
4.  **Презентер:**
    
    -   Получив событие **counter:basket**, запрашивает обновлённые данные (например, количество товаров и общую стоимость) через геттеры `totalPrice` и `allIdProducts`.
5.  **Вью:**
    
    -   Класс `Basket` обновляет интерфейс, перерисовывая список товаров и общую стоимость.

----------

## ТИПЫ ДАННЫХ

### IOrder

**Описание:**  
Объект, представляющий заказ.

**Поля:**

-   `items: string[]` – массив идентификаторов товаров, входящих в заказ.
-   `total: number` – общая сумма заказа.
-   `paymentMethod?: 'card' | 'cash'` – (опционально) способ оплаты.
-   `address?: string` – (опционально) адрес доставки.
-   `contactEmail?: string` – (опционально) email для контакта.
-   `contactPhone?: string` – (опционально) телефон для контакта.

`interface  IOrder { items: string[]; total: number;
  paymentMethod?: 'card' | 'cash';
  address?: string;
  contactEmail?: string;
  contactPhone?: string;
}` 

----------

### IAppState

**Описание:**  
Объект, представляющий состояние приложения.

**Поля:**

-   `massProduct: IProduct[]` – список всех доступных товаров.
-   `basketItems: IProduct[]` – список товаров, добавленных в корзину.
-   `order: IOrder` – данные текущего заказа.
-   `formErrors: { [key: string]: string }` – ошибки валидации форм.

`interface  IAppState { massProduct: IProduct[]; basketItems: IProduct[]; order: IOrder; formErrors: { [key: string]: string };
}` 

----------

## Типы для компонентов

### ProductCardProps

**Описание:**  
Свойства для компонента карточки товара.

**Поля:**

-   `product: IProduct` – данные товара.
-   `onAddToCart: (product: IProduct) => void` – функция-обработчик для добавления товара в корзину.

`interface  ProductCardProps { product: IProduct; onAddToCart: (product: IProduct) => void;
}` 

----------

### OrderFormProps

**Описание:**  
Свойства для компонента формы оформления заказа.

**Поля:**

-   `onSubmit: (order: IOrder) => void` – функция-обработчик отправки заказа.
-   `formErrors: { [key: string]: string }` – ошибки валидации формы заказа.

`interface  OrderFormProps { onSubmit: (order: IOrder) => void; formErrors: { [key: string]: string };
}` 

----------

### ContactsFormProps

**Описание:**  
Свойства для компонента формы контактов.

**Поля:**

-   `onSubmit: (contactData: { email: string; phone: string }) => void` – функция-обработчик отправки контактных данных.
-   `formErrors: { [key: string]: string }` – ошибки валидации для контактной формы.

`interface  ContactsFormProps { onSubmit: (contactData: { email: string; phone: string }) => void; formErrors: { [key: string]: string };
}` 

----------

## Дополнительные типы

### ApiOptions

**Описание:**  
Опции для настройки HTTP‑запросов в классе Api.

**Поля:**

-   `headers?: { [key: string]: string }` – дополнительные HTTP‑заголовки.
-   `credentials?: RequestCredentials` – настройки передачи кукис и прочих параметров запроса.

`interface  ApiOptions {
  headers?: { [key: string]: string };
  credentials?: RequestCredentials;
}` 

----------

### EventCallback

**Описание:**  
Тип для обработчиков событий, позволяющий принимать произвольное число аргументов.

`type  EventCallback = (...args: any[]) => void;`