# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Larek Frontend

Документация по архитектуре веб‑проекта «Larek Frontend» оформлена согласно паттерну MVP (Model‑View‑Presenter) и событийно‑ориентированному подходу. В данном проекте реализовано четкое разделение ответственности между тремя слоями:

- **Модель** – отвечает за хранение и управление данными приложения (каталог товаров, корзина, заказ, ошибки валидации).
- **Представление (View)** – отвечает за отображение информации, рендеринг элементов интерфейса и обработку событий, происходящих в DOM.
- **Презентер** – связывает Модель и Представление, обрабатывает события от пользователя, инициирует изменение данных в модели и обновление представления.

---

## СЛОЙ МОДЕЛЬ

### Класс Api

**Назначение:**  
Класс `Api` служит для взаимодействия с REST‑API. Он инкапсулирует логику отправки HTTP‑запросов, обработки ответов и ошибок.

**Конструктор:**  
Принимает два параметра:  
- `baseUrl` (строка) — базовый URL для запросов.  
- `options` (объект настроек запроса) — дополнительные параметры (например, заголовки).

**Поля:**  
- `baseUrl` – базовый URL для всех запросов.  
- `options` – настройки (например, заголовки) для HTTP‑запросов.

**Методы:**  
- `handleResponse(response)` – обрабатывает ответ сервера. Если запрос успешный, возвращает JSON‑представление, иначе генерирует ошибку.  
- `get(uri)` – выполняет GET‑запрос по указанному URI, объединяя его с `baseUrl`, и возвращает результат через обработчик ответа.  
- `post(uri, data, method = 'POST')` – выполняет POST‑или PUT‑запрос с переданными данными (сериализует данные в JSON) и обрабатывает ответ.

---

### Класс AppState

**Назначение:**  
Класс `AppState` отвечает за хранение и управление состоянием приложения. Он содержит данные о каталоге товаров, корзине, заказе и ошибках форм.

**Конструктор:**  
При инициализации создаются следующие поля:
- `massProduct` – массив товаров (каталог товаров).
- `basketItems` – массив товаров, добавленных в корзину.
- `order` – объект, представляющий заказ (например, список идентификаторов товаров и итоговая сумма).
- `formErrors` – объект, где ключами являются названия полей формы, а значениями – сообщения об ошибках.

**Поля:**  
- `massProduct` – данные о всех доступных товарах.  
- `basketItems` – список товаров в корзине.  
- `order` – данные текущего заказа (список товаров и общая стоимость).  
- `formErrors` – ошибки валидации для форм (контакты, заказ).

**Методы:**  
- `setContactField(field, value)` – устанавливает значение контактного поля заказа и запускает валидацию контактов.  
- `setOrderField(field, value)` – обновляет конкретное поле заказа и инициирует валидацию заказа.  
- `validateContacts()` – проверяет корректность заполнения полей контактов (например, email, phone) и обновляет `formErrors`.  
- `validateOrder()` – проверяет поля заказа (например, способ оплаты, адрес) и обновляет ошибки.  
- **Сеттер** `addProductBasket` – добавляет товар в корзину, если его там ещё нет, и генерирует событие об изменении данных.  
- `deleteAllProducts()` – очищает корзину, сбрасывая список товаров.  
- **Геттер** `productsQuantity` – возвращает количество товаров в корзине.  
- **Геттер** `allProducts` – возвращает массив товаров в корзине.  
- **Геттер** `totalPrice` – рассчитывает и возвращает общую стоимость товаров.  
- `deleteProduct(product)` – удаляет указанный товар из корзины по его идентификатору.  
- **Геттер** `allIdProducts` – возвращает массив идентификаторов товаров в корзине.  
- `setMassProduct(products)` – устанавливает список доступных товаров каталога.  
- `getMassProduct()` – возвращает массив товаров каталога.  
- **Геттер** `orderArray` – формирует объект заказа, устанавливая итоговую сумму и список идентификаторов товаров.  
- `clearAllData()` – очищает корзину и сбрасывает данные заказа.

---

## СЛОЙ ПРЕДСТАВЛЕНИЯ (VIEW)

### Класс BaseCard

**Назначение:**  
Базовый класс для всех карточек товаров. Отвечает за хранение ссылок на элементы разметки карточки и базовую логику обновления этих элементов.

**Конструктор:**  
Принимает один параметр – HTML‑элемент карточки. В конструкторе инициализируются:
- `_card` – корневой контейнер карточки.
- `_category` – элемент, отображающий категорию товара.
- `_image` – элемент для отображения изображения.
- `_title` – элемент для заголовка.
- `_price` – элемент для цены.
- `_text` – элемент для описания.
- `_button` – кнопка для действия (например, добавление в корзину).

**Методы:**  
Для каждого визуального элемента предусмотрены сеттеры:
- `imgValue` (строка) – URL изображения.
- `priceValue` (число) – цена товара.
- `categoryValue` (строка) – текстовое значение категории.
- `categoryClass` (строка) – CSS‑класс, соответствующий категории.
- `titleValue` (строка) – заголовок товара.
- `textValue` (строка) – описание товара.

---

### Класс CatalogProduct

**Назначение:**  
Отвечает за отображение карточки товара в каталоге. При клике по карточке генерируется событие для перехода на страницу с подробной информацией о товаре.

**Конструктор:**  
Принимает два параметра:
- HTML‑элемент карточки.
- Объект‑обработчик (click‑handler), вызываемый при клике.

**Зона ответственности:**  
Генерация события при клике, которое передаётся презентеру для дальнейшей обработки.

---

### Класс Card

**Назначение:**  
Представляет отдельную карточку товара с дополнительной логикой (например, управление состоянием кнопки добавления в корзину).

**Конструктор:**  
Принимает:
- HTML‑элемент карточки.
- Булево значение, определяющее, должна ли кнопка быть заблокирована.
- Объект‑обработчик клика для кнопки.

**Методы:**  
Обрабатывает событие клика по кнопке и передаёт его в систему событий, позволяя презентеру инициировать добавление товара в корзину.

---

### Класс CardBasket

**Назначение:**  
Отвечает за отображение товара в корзине. Помимо информации, наследуемой от `BaseCard`, включает индекс товара в списке корзины.

**Конструктор:**  
Принимает HTML‑элемент карточки и объект‑обработчик клика для удаления товара из корзины.

**Поля:**  
- `_basketIndex` – HTML‑элемент для отображения порядкового номера товара в корзине.

**Методы:**  
- `basketIndex` (сеттер) – устанавливает порядковый номер товара в корзине.

---

### Класс Basket

**Назначение:**  
Отвечает за отображение и управление корзиной покупок.

**Конструктор:**  
Принимает:
- HTML‑контейнер корзины.
- Объект для работы с событиями (events‑emitter).
- Дополнительную кнопку (basketButtonBody) для управления содержимым корзины.
- Обработчик кликов для вызова дополнительных действий.

**Поля:**  
- `basket` – корневой HTML‑элемент корзины.
- `basketList` – контейнер, в котором отображаются карточки товаров.
- `basketButton` – кнопка оформления заказа.
- `basketButtonBody` – дополнительная кнопка управления.
- `_basketPrice` – элемент для отображения общей стоимости товаров.

**Методы:**  
- `basketPrice` (сеттер) – устанавливает и форматирует общую стоимость товаров в корзине.
- `getList` (геттер) – возвращает контейнер списка товаров.
- `items` (сеттер) – принимает массив HTML‑элементов карточек, обновляет содержимое корзины и активирует кнопку оформления заказа.
- `clearBasketList()` – очищает содержимое корзины.

---

### Класс Form

**Назначение:**  
Базовый класс для работы с HTML‑формами. Обеспечивает обработку ввода данных, валидацию, отправку формы и отображение ошибок.

**Конструктор:**  
Принимает:
- HTML‑элемент формы (`container`).
- Объект для работы с событиями (`events`).

**Поля:**  
- `container` – HTML‑форма.
- `_submit` – кнопка отправки формы.
- `_errors` – элемент для отображения ошибок.

**Методы:**  
- `onInputChange(field, value)` – обрабатывает изменения в полях ввода и генерирует соответствующее событие.
- `valid` (сеттер) – устанавливает состояние кнопки отправки (активна/неактивна) в зависимости от валидности формы.
- `errors` (сеттер) – отображает сообщения об ошибках.
- `render(state)` – обновляет форму, устанавливая значения полей, состояние кнопки и ошибки согласно переданным данным.

---

### Класс OrderForm

**Назначение:**  
Отвечает за представление формы оформления заказа, включая выбор способа оплаты и ввод адреса доставки.

**Конструктор:**  
Принимает:
- HTML‑элемент формы.
- Объект для работы с событиями.

**Поля:**  
- `_cardButton` – кнопка для выбора оплаты картой.
- `_cashButton` – кнопка для выбора оплаты наличными.

**Методы:**  
- `disableButtons()` – снимает активное состояние с кнопок оплаты.  
- `setPayment(value)` – устанавливает активное состояние соответствующей кнопки в зависимости от выбранного способа оплаты.  
- `address` (сеттер) – устанавливает значение поля ввода адреса доставки.

---

### Класс ContactsForm

**Назначение:**  
Представляет форму ввода контактных данных (телефон, email).

**Конструктор:**  
Принимает:
- HTML‑элемент формы.
- Объект для работы с событиями.

**Методы:**  
- `phone` (сеттер) – устанавливает значение поля телефона.
- `email` (сеттер) – устанавливает значение поля email.

---

### Класс Success

**Назначение:**  
Отвечает за отображение модального окна с сообщением об успешном оформлении заказа.

**Конструктор:**  
Принимает:
- HTML‑контейнер модального окна.
- Объект‑обработчик клика для закрытия окна.

**Поля:**  
- `container` – HTML‑контейнер модального окна.
- `orderSuccessDescription` – элемент, где отображается сообщение с суммой заказа.
- `orderSuccessClose` – кнопка для закрытия модального окна.

**Методы:**  
- `price` (сеттер) – принимает число (стоимость заказа), форматирует его (например, добавляя пробелы) и устанавливает текст в `orderSuccessDescription`.

---

## СЛОЙ ПРЕЗЕНТЕРА

**Назначение:**  
Презентер является связующим звеном между Моделью и Представлением. Он реализован в основном скрипте приложения и выполняет следующие задачи:
- **Перехват событий от View:** Например, при клике по кнопке «Добавить в корзину» класс `Card` генерирует событие `click:add:basket`.
- **Вызов методов модели:** Презентер, получив событие, вызывает метод `addProductBasket` класса `AppState` для добавления товара в корзину.
- **Обработка событий от модели:** После изменения данных модель генерирует событие (например, `counter:basket`), которое перехватывается презентером.
- **Обновление представления:** Презентер запрашивает обновлённые данные (через геттеры, например, `productsQuantity` и `totalPrice`) и передаёт их в класс `Basket`, вызывая его метод рендера для обновления отображения.

### Пример сценария взаимодействия

**Сценарий:** Пользователь нажимает кнопку «Добавить в корзину» на карточке товара.

1. **Вью:**  
   - Класс **Card** обрабатывает клик по кнопке.
   - При нажатии генерируется событие `click:add:basket`.

2. **Презентер:**  
   - Презентер перехватывает событие `click:add:basket`.
   - Вызывает метод `addProductBasket` класса **AppState**, передавая выбранный товар.

3. **Модель:**  
   - Метод `addProductBasket` проверяет, добавлен ли товар в корзину.
   - Если товар отсутствует, он добавляется в массив `basketItems` и генерируется событие, например, `counter:basket`.

4. **Презентер:**  
   - Получив уведомление об изменении данных, презентер запрашивает обновлённые данные (например, количество товаров и общую стоимость) через геттеры `productsQuantity` и `totalPrice`.
   - Передаёт эти данные в класс **Basket**.

5. **Вью:**  
   - Класс **Basket** обновляет (рендерит) интерфейс, отображая актуальный список товаров и новую общую стоимость.

---

## Заключение

Архитектура веб‑проекта **Larek Frontend** построена по принципу MVP с явным разделением на три слоя:

- **Модель** (например, классы `Api` и `AppState`) отвечает за хранение и обработку данных.
- **Представление (View)** (например, классы `BaseCard`, `CatalogProduct`, `Card`, `CardBasket`, `Basket`, `Form`, `OrderForm`, `ContactsForm`, `Success`) отвечает за отображение интерфейса и взаимодействие с пользователем.
- **Презентер** (реализованный в основном скрипте) связывает модель и представление, обрабатывая события и обновляя интерфейс.

---

## Типы данных

### IOrder

**Описание:**  
Объект, представляющий заказ.

**Поля:**

-   `items: string[]` – массив идентификаторов товаров, входящих в заказ.
-   `total: number` – общая сумма заказа.
-   `paymentMethod?: 'card' | 'cash'` – (опционально) способ оплаты.
-   `address?: string` – (опционально) адрес доставки.
-   `contactEmail?: string` – (опционально) email для контакта.
-   `contactPhone?: string` – (опционально) телефон для контакта.

`interface  IOrder { items: string[]; total: number;
  paymentMethod?: 'card' | 'cash';
  address?: string;
  contactEmail?: string;
  contactPhone?: string;
}` 

----------

### IAppState

**Описание:**  
Объект, представляющий состояние приложения.

**Поля:**

-   `massProduct: IProduct[]` – список всех доступных товаров.
-   `basketItems: IProduct[]` – список товаров, добавленных в корзину.
-   `order: IOrder` – данные текущего заказа.
-   `formErrors: { [key: string]: string }` – ошибки валидации форм.

`interface  IAppState { massProduct: IProduct[]; basketItems: IProduct[]; order: IOrder; formErrors: { [key: string]: string };
}` 

----------

## Типы для компонентов

### ProductCardProps

**Описание:**  
Свойства для компонента карточки товара.

**Поля:**

-   `product: IProduct` – данные товара.
-   `onAddToCart: (product: IProduct) => void` – функция-обработчик для добавления товара в корзину.

`interface  ProductCardProps { product: IProduct; onAddToCart: (product: IProduct) => void;
}` 

----------

### OrderFormProps

**Описание:**  
Свойства для компонента формы оформления заказа.

**Поля:**

-   `onSubmit: (order: IOrder) => void` – функция-обработчик отправки заказа.
-   `formErrors: { [key: string]: string }` – ошибки валидации формы заказа.

`interface  OrderFormProps { onSubmit: (order: IOrder) => void; formErrors: { [key: string]: string };
}` 

----------

### ContactsFormProps

**Описание:**  
Свойства для компонента формы контактов.

**Поля:**

-   `onSubmit: (contactData: { email: string; phone: string }) => void` – функция-обработчик отправки контактных данных.
-   `formErrors: { [key: string]: string }` – ошибки валидации для контактной формы.

`interface  ContactsFormProps { onSubmit: (contactData: { email: string; phone: string }) => void; formErrors: { [key: string]: string };
}` 

----------

## Дополнительные типы

### ApiOptions

**Описание:**  
Опции для настройки HTTP‑запросов в классе Api.

**Поля:**

-   `headers?: { [key: string]: string }` – дополнительные HTTP‑заголовки.
-   `credentials?: RequestCredentials` – настройки передачи кукис и прочих параметров запроса.

`interface  ApiOptions {
  headers?: { [key: string]: string };
  credentials?: RequestCredentials;
}` 

----------

### EventCallback

**Описание:**  
Тип для обработчиков событий, позволяющий принимать произвольное число аргументов.

`type  EventCallback = (...args: any[]) => void;`